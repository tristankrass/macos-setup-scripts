- hosts: localhost
  connection: local
  tasks:
    - debug:
        msg: Check we are running in the directory of the script
      failed_when: not ansible_env.PWD.endswith('/macos-setup-scripts')

- hosts: localhost
  connection: local
  become: no

  tasks:

    - name: Install Software
      include_tasks: tasks/software.yml

    - name: Setup Shell Environment
      include_tasks: tasks/shell.yml

    - name: Setup Dotfiles
      include_tasks: tasks/dotfiles.yml

    - name: Apply macOS System Settings
      script: scripts/macos-settings.sh

    - name: Setup Dock
      include_tasks: tasks/dock.yml

  handlers:
    - name: kill dock
      command: killall Dock

    - name: kill finder
      command: killall Finder
